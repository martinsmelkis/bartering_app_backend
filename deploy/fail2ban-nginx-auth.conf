# Fail2Ban Filter for Authentication Failures
# Place this file in /etc/fail2ban/filter.d/nginx-auth.conf
#
# This filter detects repeated authentication failures from signature verification
# Monitors 401/403 responses from authenticated API endpoints

[Definition]

# Match 401 Unauthorized or 403 Forbidden on authenticated endpoints
# These endpoints use signature verification (verifyRequestSignature)
# Examples:
# - DELETE /api/v1/authentication/user/{userId} (user deletion)
# - POST /api/v1/profile-update (profile updates)
# - GET /api/v1/profiles/nearby (location-based queries)
# - GET /api/v1/profiles/search (keyword search)
# - POST /api/v1/postings (creating postings)
# - PUT /api/v1/postings/{postingId} (updating postings)
# - DELETE /api/v1/postings/{postingId} (deleting postings)
# - Any other endpoint that requires authentication

failregex = ^<HOST> .* "(GET|POST|PUT|DELETE|PATCH) /api/v1/.*" (401|403|429)

# Ignore successful requests
ignoreregex = .* (200|201|204) .*
